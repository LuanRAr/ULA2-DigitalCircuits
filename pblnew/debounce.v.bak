module debounce(
    input clk,           // Clock do sistema
    input btn_in,        // Sinal de chave (KEY)
    output reg btn_out   // Sinal debounced
);

    reg [15:0] counter; // Contador de estabilidade do sinal
    reg btn_reg, btn_reg2;

    always @(posedge clk) begin
        // Armazena os estados anteriores do botão
        btn_reg <= btn_in;
        btn_reg2 <= btn_reg;

        // Se houver uma mudança de nível entre btn_reg2 e btn_in,
        // o contador é reiniciado.
        if (btn_reg2 != btn_reg) begin
            counter <= 0;
        end else if (counter < 16'hFFFF) begin
            counter <= counter + 1;
        end else begin
            // Se o contador atingir o valor máximo, o sinal é considerado estabilizado.
            btn_out <= btn_reg;
        end
    end
endmodule
